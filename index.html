<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>D3 Project</title>
  <script type="text/javascript" src="https://d3js.org/d3.v4.min.js"></script>
  <style type="text/css">
/* Layout */
  * {
  box-sizing: border-box;
  font-size: 12pt;
  }

  .content {
    max-width: 1220px;
    margin:auto;
  }

  .annotations{
    padding: 0px;
    margin: 0px;
  }

  .annotations h2{
    font-size: 24pt;
  }

  .qualityDaysHolder {
    float:left;
    width: 50%;
    margin: 0;
  }

  .polutionDaysHolder {
    float:right;
    width: 50%;
    padding-left: 20px;
  }

  .qualityDaysLegendLeft {
    float:left;
    width: 50%;
    height: 180;
  }

  .qualityDaysLegendRight {
    float:right;
    width: 50%;
    height: 180;
  }

  .polutionDaysLegendLeft {
    float:left;
    width: 50%;
    height: 180;
  }

  .polutionDaysLegendRight {
    float:right;
    width: 50%;
    height: 180;
  }


  /*quality Lines details */

  .Good_Days_Line {
    fill: none;
    stroke: green;
    stroke-width: 2.0;
  }

  .Good_Days_Legend {
    background-color: green;
    margin: 0px;
    height: 60px;
  }

  .Moderate_Days_Line {
    fill: none;
    stroke: gold;
    stroke-width: 2.0;
  }

  .Moderate_Days_Legend {
    background-color: gold;
    margin: 0px;
    height: 60px;
  }

  .Unhealthy_for_Sensitive_Groups_Days_Line {
    fill: none;
    stroke: orange;
    stroke-width: 2.0;
  }

  .Unhealthy_for_Sensitive_Groups_Days_Legend {
    background-color: orange;
    margin: 0px;
    color: white;
    height: 60px;
  }

  .Unhealthy_Days_Line {
    fill: none;
    stroke: red;
    stroke-width: 2.0;
  }

  .Unhealthy_Days_Legend {
    background-color: red;
    color: white;
    margin: 0px;
    height: 60px;
  }

  .Very_Unhealthy_Days_Line {
    fill: none;
    stroke: purple;
    stroke-width: 2.0;
  }

  .Very_Unhealthy_Days_Legend {
    background-color: purple;
    color: white;
    margin: 0px;
    height: 60px;
  }

  .Hazardous_Days_Line {
    fill: none;
    stroke: brown;
    stroke-width: 2.0;
  }

  .Hazardous_Days_Legend {
    background-color: brown;
    color: white;
    margin: 0px;
    height: 60px;
  }

  /*polutant Lines details */

  .Days_SO2_Line {
    fill: none;
    stroke: yellow;
    stroke-width: 2.0;
  }

  .Days_SO2_Legend {
    background-color: yellow;
    color: black;
    margin: 0px;
    height: 60px;
  }

  .Days_CO_Line {
    fill: none;
    stroke: purple;
    stroke-width: 2.0;
  }

  .Days_CO_Legend {
    background-color: purple;
    color: white;
    margin: 0px;
    height: 60px;
  }

  .Days_NO2_Line {
    fill: none;
    stroke: Olive;
    stroke-width: 2.0;
  }

  .Days_NO2_Legend {
    background-color: olive;
    color: white;
    margin: 0px;
    height: 60px;
  }

  .Days_PM10_Line {
    fill: none;
    stroke: SlateBlue;
    stroke-width: 2.0;
  }

  .Days_PM10_Legend {
    background-color: SlateBlue;
    color: white;
    margin: 0px;
    height: 60px;
  }

  .Days_PM25_Line {
    fill: none;
    stroke: Tomato;
    stroke-width: 2.0;
  }

  .Days_PM25_Legend {
    background-color: Tomato;
    color: white;
    margin: 0px;
    height: 60px;
  }

  .Days_Ozone_Line {
    fill: none;
    stroke: SaddleBrown;
    stroke-width: 2.0;
  }

  .Days_Ozone_Legend {
    background-color: SaddleBrown;
    color: white;
    margin: 0px;
    height: 60px;
  }

  /* Navigation Bar Container*/
  .navigationBar {
    overflow:hidden;
    background-color: #333;
    font-family: Arial;
  }

  /* Links inside the navbar */
  .navigationBar a {
    float: left;
    font-size: 16px;
    color: white;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
  }

  /* dropDown container */
  .dropDown{
    float:left;
    overflow: hidden;
  }

  /* drop down button */
  .dropDown .dropDownButton {
    font-size: 16px;
    border: none;
    outline: none;
    color:white;
    padding: 14px 16px;
    background-color: inherit;
    font-family: inherit;
    margin:0;
  }

  /* add navigation bar hover characteristics */
  .navigationBar a:hover, .dropDown:hover .dropDownButton {
    background-color: red;
  }

  /* hide dropdown-content content by default */
  .dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    overflow: auto;
    max-height: 250px;

  }

  /* Links insdie the dropdown */
  .dropdown-content a {
    float:none;
    color: black;
    padding: 12 px 16px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  /* add dropdown hover behavior */
  .dropdown-content a:hover {
    background-color: #ddd;
  }

  /*show dropdown menu on hover */
  .dropDown:hover .dropdown-content {
    display:block;
  }

  /* Modal (background) */
  .modal {
    display:none;
    position: fixed;
    z-index:1;
    left:0;
    top:0;
    width: 100%;
    height: 100%;
    overflow:auto;
    background-color: rgb(0,0,0);
    background-color: rgba(0,0,0,0.4);
  }

  /*modal content/box*/
  .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
  }

  /*Close button*/
  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  .svg {
    margin: 0;
  }

  .annontationText_id {
    margin: 0;
  }
  </style>
</head>
<body>
  <div class="content" id="content_container">
    <div class="navigationBar">
      <a href="#modal" id="VisualizationButton">About the Visualization</a>
      <a href="#back" id="backButton">Back</a>
      <a href="#next" id="nextButton">Next</a>
      <div class="dropDown">
        <button class="dropDownButton">Choose State
        </button>
        <div class="dropdown-content" id="stateDrop"></div>
      </div>
    </div>

    <div class="annotations" id="annotations_id">
      <h2 id="annontationTitle_id"></h2>
      <p id="annontationText_id"></p>
    </div>

    <div class="qualityDaysHolder">
      <div class="qualityDaysGraphDIV" id="qualityDaysGraphDIV_id">
      </div>

      <div class="qualityDaysLegendHolder" id="qualityDaysLegendHolder_id">
        <div class="qualityDaysLegendLeft" id="qualityDaysLegendLeft_id"></div>
        <div class="qualityDaysLegendRight" id="qualityDaysLegendRight_id"></div>
      </div>
    </div>

    <div class="polutionDaysHolder">
    <div class="polutionDaysGraphDIV" id="polutionDaysGraphDIV_id">
    </div>

    <div class="polutionDaysLegend" id="polutionDaysLegend_id">
      <div class="polutionDaysLegendLeft" id="polutionDaysLegendLeft_id"></div>
      <div class="polutionDaysLegendRight" id="polutionDaysLegendRight_id"></div>
    </div>
  </div>

  <!-- Modal -->
  <div id="VisualizationModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <p>Some text in the Modal..</p>
    </div>
  </div>
  <div id="tooltip"></div>



    <script type="text/javascript">
/* Borrowed extesively from w3schools.com how to modal */
      var modal = document.getElementById('VisualizationModal');
      var btn = document.getElementById("VisualizationButton");
      var span = document.getElementsByClassName("close")[0];
      btn.onclick = function() {
        modal.style.display = "block";
      }
      span.onclick = function(event) {
        modal.style.display = "none";
      }
      window.onclick = function(event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }



      var tooltip = d3.select("#tooltip");



    // Global variables
    var dataset;
    var currentStateSelection = "All U.S. States";
    var statesArray;
    var currentSlide = 0;
    var currentSlideMax;
    //var filteredData = [];

    var w = 600;
    var h = 400;
    var padding = 40;
      
    var slideStateArray = [true,true,true,true,true,true,true,true,true,true,true,true,true];  //denotes whether a slide less than 31 has not been visited

    //qualityDays legend text Array
    var legendText = [
      ["Value 0", ""],
      ["Proportion of \"Good\" Days. AQI is 0 to 50.", "Good_Days"],
      ["Proportion of \"Moderate\" Days. AQI is 51 to 100.", "Moderate_Days"],
      ["Proportion of \"Unhealthy for Sensitive Groups\" Days. AQI is 101 to 150.", "Unhealthy_for_Sensitive_Groups_Days"],
      ["Proportion of \"Unhealthy\" Days. AQI is 151 to 200.", "Unhealthy_Days"],
      ["Proportion of \"Very Unhealthy\" Days. AQI is 201 to 300.", "Very_Unhealthy_Days"],
      ["Proportion of \"Hazardous\" Days. AQI greater than 300.", "Hazardous_Days"],
      ["Proportion of Days where carbon monoxide (CO) was the dominant polutant.", "Days_CO"],
      ["Proportion of Days where nitrogen dioxide (NO2) was the dominant polutant.", "Days_NO2"],
      ["Proportion of Days where ozone (O2) was the dominant polutant.", "Days_Ozone"],
      ["Proportion of Days where sulfur dioxide (SO2) was the dominant polutant.", "Days_SO2"],
      ["Proportion of Days where PM 10 (particulate mater < 10 micrometers) was the dominant polutant.", "Days_PM25"],
      ["Proportion of Days where PM 2.5 (particulate mater < 2.5 micrometers) was the dominant polutant.", "Days_PM10"]
    ];

    // Annotation text
    var annotationText = [ //annotation title, annotation value
      ["Changes in U.S. Polution and Predominate Polutants 1980-2017", "This data comes from the AirData section of the EPA’s web site <a href=/”https://aqs.epa.gov/aqsweb/airdata/download_files.html/”>(https://aqs.epa.gov/aqsweb/airdata/download_files.html)</a>, specifically, the Annual Summary Data: AQI by county for the years 1980 through 2017. The data is a summary of the yearly Air Quality Index(AQI) data for the U.S. as calculated by the EPA. In general, AQI is a measure of a pollutant’s presence compared to its defined acceptable level. Where multiple pollutants are measured, the total AQI is the value of the pollutant with the highest individual AQI. Total AQI is then used to qualify measured days as Good Days (AQI: 0-50), Moderate Days (AQI: 50-100), Unhealthy for Sensitive Groups Days (AQI: 100-150), Unhealthy Days (AQI: 150-200), Very Unhealthy Days (AQI: 200-250) and Hazardous Days (AQI: 250-300). Additionally, the determining pollutant, the one with the highest individual AQI, is also recorded. More information about AQI can be found here <a href=/” https://www.airnow.gov/index.cfm?action=aqibasics.aqi/”> https://www.airnow.gov/index.cfm?action=aqibasics.aqi</a> and here <a href=/”https://en.wikipedia.org/wiki/Air_quality_index#United_States/”> https://en.wikipedia.org/wiki/Air_quality_index#United_States</a> I filtered the data by dividing all measures, e.g. good days, moderate days, pollutants, etc. by the number of recorded days for that monitoring site in order to have comparable data. The average was then taken over all monitoring sites per year under consideration (and current filters) to produce the values used in the chart. <p>This Visualization is best viewed at 1920x1080 in a full sized browser window.</p> <p>Please press <b>'next'</b> to begin.</p>"],
      ["'Good Days': Proportion of Days where AQI is 0 to 50", "'\"Good\" Days measures the proportion of days where the AQI is between 0 and 50. At this level air quality is considered 'satisfactory, and air pollution poses little or no risk.' <a href= \"https://airnow.gov/index.cfm?action=aqibasics.aqi\">https://airnow.gov/index.cfm?action=aqibasics.aqi</a>"],
      ["'Moderate Days': Proportion of Days where AQI is 51 to 100", "\"Moderate\" Days measures the proportion of days where the AQI is between 51 and 100. At this level, 'Air quality is acceptable; however, for some pollutants there may be a moderate health concern for a very small number of people. For example, people who are unusually sensitive to ozone may experience respiratory symptoms.' <a href= \"https://airnow.gov/index.cfm?action=aqibasics.aqi\">https://airnow.gov/index.cfm?action=aqibasics.aqi</a>"],
      ["'Unhealthy for Sensitive Groups Days': Proportion of Days where the AQI is 101 to 150", "\"Unhealthy for Sensitive Groups\" days measures the proportion of days where AQI is between 101 and 150. 'Although general public is not likely to be affected at this AQI range, people with lung disease, older adults and children are at a greater risk from exposure to ozone, whereas persons with heart and lung disease, older adults and children are at greater risk from the presence of particles in the air.'<a href= \"https://airnow.gov/index.cfm?action=aqibasics.aqi\">https://airnow.gov/index.cfm?action=aqibasics.aqi</a>"],
      ["'Unhealthy Days': Proportion of Days where the AQI is 151 to 200", "\"Unhealthy\" Days measures the proportion of days where the AQI is between 151 and 200. At this level, 'Everyone may begin to experience some adverse health effects, and members of the sensitive groups may experience more serious effects.' <a href= \"https://airnow.gov/index.cfm?action=aqibasics.aqi\">https://airnow.gov/index.cfm?action=aqibasics.aqi</a>"],
      ["'Very Unhealthy Days': Proportion of Days where the AQI is 201 to 300", "\"Very Unhealthy\" Days measures the proportion of days where the AQI is between 201 and 300. This level 'would trigger a health alert signifying that everyone may experience more serious health effects.' <a href= \"https://airnow.gov/index.cfm?action=aqibasics.aqi\">https://airnow.gov/index.cfm?action=aqibasics.aqi</a>"],
      ["'Hazardous Days': Proportion of Days where the AQI is greater than 300", "\"Hazardous\" Days measures the proportion of days where the AQI is greater than 300. This level 'would trigger a health warnings of emergency conditions. The entire population is more likely to be affected.' <a href= \"https://airnow.gov/index.cfm?action=aqibasics.aqi\">https://airnow.gov/index.cfm?action=aqibasics.aqi</a>)"],
      ["Proportion of Days Where CO Determined AQI Value", "This score measures the proportion of recorded days where carbon monoxide (CO) was the most prevalent pollutant, and thereby determined the AQI score for that day. If I had more time here is where I would include information and research about carbon monoxide (CO) and it’s effects on human health and the environment."],
      ["Proportion of Days Where NO2 Determined AQI Value", "This score measures the proportion of recorded days where nitrogen dioxide (NO2) was the most prevalent pollutant, and thereby determined the AQI score for that day. If I had more time here is where I would include information and research about nitrogen dioxide (NO2) and it’s effects on human health and the environment."],
      ["Proportion of Days Where Ozone Determined AQI Value", "This score measures the proportion of recorded days where ozone (O2) was the most prevalent pollutant, and thereby determined the AQI score for that day. If I had more time here is where I would include information and research about ozone (O2) and it’s effects on human health and the environment."],
      ["Proportion of Days Where SO2 Determined AQI Value", "This score measures the proportion of recorded days where sulfur dioxide (SO2) was the most prevalent pollutant, and thereby determined the AQI score for that day. If I had more time here is where I would include information and research about sulfur dioxide (SO2) and it’s effects on human health and the environment."],
      ["Proportion of Days Where PM 2.5 Determined AQI Value", "This score measures the proportion of recorded days where PM 10 (particulate matter less than 10 micrometers in diameter) was the most prevalent pollutant, and thereby determined the AQI score for that day. If I had more time here is where I would include information and research about PM 10 and it’s effects on human health and the environment."],
      ["Proportion of Days Where PM 10 Determined AQI Value", "This score measures the proportion of recorded days where PM 2.5 (particulate matter less than 2.5 micrometers in diameter) was the most prevalent pollutant, and thereby determined the AQI score for that day. If I had more time here is where I would include information and research about PM 2.5 and it’s effects on human health and the environment."],
      ["U.S Polution for All States", "Placeholder"],
      ["Most Urban State: New Jersy", "Placeholder"],
      ["Second Most Urban State: Rhode Island", "Placeholder"],
      ["Third Most Urban State: Massachusettes", "Placeholder"],
      ["Most Rural State: Alaska", "Placeholder"],
      ["Second Most Rural State: Wyoming", "Placeholder"],
      ["Third Most Rural State: Montana", "Placeholder"],
      ["U.S Polution for All States", "Please explore the data for your home state, your home state's rival, or any other state you are interested in by choosing a state from 'Choose State' above."]
    ];

    //Annotation data for states
    var stateAnnotations = [
      ["All U.S. States", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Alabama", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Alaska", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Arizona", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Arkansas", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["California", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Colorado", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Connecticut", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Delaware", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Delaware", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Florida", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Georgia", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Hawaii", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Idaho", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Illinois", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Indiana", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Iowa", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Kansas", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Kentucky", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Louisiana", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Maine", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Maryland", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Massachusetts", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Michigan", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Minnesota", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Mississippi", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Missouri", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Montana", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Nebraska", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Nevada", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["New Hampshire", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["New Jersey", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["New Mexico", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["New York", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["North Carolina", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["North Dakota", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Ohio", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Oklahoma", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Oregon", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Pennsylvania", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Rhode Island", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["South Carolina", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["South Dakota", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Tennessee", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Texas", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Utah", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Vermont", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Virginia", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Washington", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["West Virginia", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Wisconsin", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["Wyoming", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."],
      ["District of Columbia", "Here is where you would place the relevant environmental legistlation and impact events that you want to call out for this state. This would require domain knowledge beyond the scope of this course. For now."]
    ];

    // Functions
    var parseTime = d3.timeParse("%Y");
    var rowConverter = function(d) {
      return {
        State: d.State,
        County: d.County,
        Year: new Date(+d.Year, 0, 1),
        Days_with_AQI: +(d["Days with AQI"]),
        Good_Days: +(d["Good Days"]),
        Moderate_Days: +(d["Moderate Days"]),
        Unhealthy_for_Sensitive_Groups_Days: +(d["Unhealthy for Sensitive Groups Days"]),
        Unhealthy_Days: +(d["Unhealthy Days"]),
        Very_Unhealthy_Days: +(d["Very Unhealthy Days"]),
        Hazardous_Days: +(d["Hazardous Days"]),
        Max_AQI: +(d["Max AQI"]),
        Percentile_AQI_90th:+(d["90th Percentile AQI"]),
        Median_AQI: +(d["Median AQI"]),
        Days_CO: +(d["Days CO"]),
        Days_NO2: +(d["Days NO2"]),
        Days_Ozone: +(d["Days Ozone"]),
        Days_SO2: +(d["Days SO2"]),
        Days_PM25: +(d["Days PM2.5"]),
        Days_PM10: +(d["Days PM10"])
      };
    }

    var nextButtonFunctionInitialize = function(targetQuality, targetPolutant, dataset){
      d3.select("#nextButton")
      .on("click", function (d) {
        if (currentSlide==0) {
          for(i=0;i<slideStateArray.length;i++){
            slideStateArray[i]=true;
          }
          targetQuality.selectAll("path")
                       .remove();
          targetPolutant.selectAll("path")
                       .remove();
          d3.select("#qualityDaysLegendHolder_id")
            .selectAll("p")
            .remove();
          d3.select("#polutionDaysLegend_id")
            .selectAll("p")
            .remove();
        }
        if (currentSlide < currentSlideMax-1) {
          currentSlide++;
        }

        d3.select("#annontationTitle_id")
        .html(annotationText[currentSlide][0]);

        d3.select("#annontationText_id")
        .html(annotationText[currentSlide][1]);

        if(currentSlide > 0 && currentSlide < 4){
          if (slideStateArray[currentSlide]){
            slideStateArray[currentSlide] = false;
          d3.select("#qualityDaysLegendLeft_id")
          .append("p")
          .attr("class",legendText[currentSlide][1]+"_Legend")
          .html(legendText[currentSlide][0]);
          

          lineDrawer(targetQuality, dataset, currentStateSelection,
            legendText[currentSlide][1], legendText[currentSlide][1]+"_Line");
          }
          } else if(currentSlide > 3 && currentSlide < 7){
            if (slideStateArray[currentSlide]){
              slideStateArray[currentSlide] = false;
            d3.select("#qualityDaysLegendRight_id")
            .append("p")
            .attr("class",legendText[currentSlide][1]+"_Legend")
            .html(legendText[currentSlide][0]);

            lineDrawer(targetQuality, dataset, currentStateSelection,
              legendText[currentSlide][1], legendText[currentSlide][1]+"_Line");
            }
          } else if(currentSlide > 6 && currentSlide < 10){
            if (slideStateArray[currentSlide]){
              slideStateArray[currentSlide] = false;
            d3.select("#polutionDaysLegendLeft_id")
            .append("p")
            .attr("class",legendText[currentSlide][1]+"_Legend")
            .html(legendText[currentSlide][0]);

            lineDrawer(targetPolutant, dataset, currentStateSelection,
              legendText[currentSlide][1], legendText[currentSlide][1]+"_Line");
            }
          
          } else if(currentSlide > 9 && currentSlide < 13){
            if (slideStateArray[currentSlide]){
              slideStateArray[currentSlide] = false;
            d3.select("#polutionDaysLegendRight_id")
            .append("p")
            .attr("class",legendText[currentSlide][1]+"_Legend")
            .html(legendText[currentSlide][0]);
            lineDrawer(targetPolutant, dataset, currentStateSelection,
              legendText[currentSlide][1], legendText[currentSlide][1]+"_Line");
            }
          } else if(currentSlide == 13){
            currentStateSelection = "All U.S. States";


              lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

              lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");

          } else if(currentSlide == 14){
            currentStateSelection = "New Jersey";;
            d3.select("#backButton")
              .attr("display","none");
              lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

              lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
          } else if(currentSlide == 15){
            currentStateSelection = "Rhode Island";;

              lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

              lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
          } else if(currentSlide == 16){
            currentStateSelection = "Massachusetts";;

              lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

              lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
          } else if(currentSlide == 17){
            currentStateSelection = "Alaska";;

              lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

              lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
          } else if(currentSlide == 18){
            currentStateSelection = "Wyoming";;

              lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

              lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
          } else if(currentSlide == 19){
            currentStateSelection = "Montana";;

              lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

              lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
          } else if(currentSlide == 20){
            currentStateSelection = "All U.S. States";;

              lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

              lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
              lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
          }
        })
      }

      var backButtonFunctionInitialize = function(targetQuality, targetPolutant, dataset){
        d3.select("#backButton")
          .attr("display","none")
          .on("click", function (d) {
          if (currentSlide > 0) {
            currentSlide--;
          }
          
          if (currentSlide==0) {
          
          targetQuality.selectAll("path")
                       .remove();
          targetPolutant.selectAll("path")
                       .remove();
          d3.select("#qualityDaysLegendHolder_id")
            .selectAll("p")
            .remove();
          d3.select("#polutionDaysLegend_id")
            .selectAll("p")
            .remove();
            
            for(i=1;i<13;i++){
              if(i<4){
                d3.select("#qualityDaysLegendLeft_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              } else if (i<7) {
                d3.select("#qualityDaysLegendRight_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              } else if (i<10) {
                d3.select("#polutionDaysLegendLeft_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              } else {
                d3.select("#polutionDaysLegendRight_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              }
            }
            
            lineDrawer(targetQuality, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
            lineDrawer(targetQuality, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
            lineDrawer(targetQuality, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
            lineDrawer(targetQuality, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
            lineDrawer(targetQuality, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
            lineDrawer(targetQuality, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
            
            
        }

          d3.select("#annontationTitle_id")
          .html(annotationText[currentSlide][0]);

          d3.select("#annontationText_id")
          .html(annotationText[currentSlide][1]);
/*
          if(currentSlide > 0 && currentSlide < 4){
            d3.select("#qualityDaysLegendLeft_id")
            .append("p")
            .html(legendText[currentSlide][0]);

            lineDrawer(targetQuality, dataset, currentStateSelection,
              legendText[currentSlide][1], legendText[currentSlide][1]+"_Line");
            } else if(currentSlide > 3 && currentSlide < 7){
              d3.select("#qualityDaysLegendRight_id")
              .append("p")
              .html(legendText[currentSlide][0]);

              lineDrawer(targetQuality, dataset, currentStateSelection,
                legendText[currentSlide][1], legendText[currentSlide][1]+"_Line");
            } else if(currentSlide > 6 && currentSlide < 10){

              d3.select("#polutionDaysLegendLeft_id")
              .append("p")
              .html(legendText[currentSlide][0]);

              lineDrawer(targetPolutant, dataset, currentStateSelection,
                legendText[currentSlide][1], legendText[currentSlide][1]+"_Line");
            } else if(currentSlide > 9 && currentSlide < 13){

              d3.select("#polutionDaysLegendRight_id")
              .append("p")
              .html(legendText[currentSlide][0]);
              lineDrawer(targetPolutant, dataset, currentStateSelection,
                legendText[currentSlide][1], legendText[currentSlide][1]+"_Line");
            } else */
             if(currentSlide == 13){
              currentStateSelection = "All U.S. States";
              d3.select("#backButton")
                .attr("display","none");

                lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

                lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");

            } else if(currentSlide == 14){
              currentStateSelection = "New Jersey";;

                lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

                lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
            } else if(currentSlide == 15){
              currentStateSelection = "Rhode Island";;

                lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

                lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
            } else if(currentSlide == 16){
              currentStateSelection = "Massachusetts";;

                lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

                lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
            } else if(currentSlide == 17){
              currentStateSelection = "Alaska";;

                lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

                lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
            } else if(currentSlide == 18){
              currentStateSelection = "Wyoming";;

                lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

                lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
            } else if(currentSlide == 19){
              currentStateSelection = "Montana";;

                lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

                lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
            } else if(currentSlide == 20){
              currentStateSelection = "All U.S. States";;

                lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

                lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
                lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
            }
          })
        }

    var statesGenerator = function ( data ) {
      //generates and returns and array of the names of all states used in the data
      var tempArray;
      var stateCount = 0;
      var stateInList = false;

      tempArray = ["All U.S. States"];
      for( i = 0; i<data.length; i++) {

        for( j = 0; j < tempArray.length; j++){

          if(data[i]["State"] == tempArray[j]) {
            stateInList = true;
            break;
          }
        }

        if(!stateInList &&
          data[i]["State"] != "Guam" &&
          data[i]["State"] != "Canada" &&
          data[i]["State"] != "Country Of Mexico" &&
          data[i]["State"] != "Virgin Islands"){
          stateCount++;
          tempArray[stateCount] = data[i]["State"];

        }
        stateInList = false;
      }

      var temp = tempArray[stateCount];
      for(i=tempArray.length-1; i> 43; i--) {
        tempArray[i] = tempArray[i-1];
      }
      tempArray[43] = temp;

      return tempArray;
    }

    var addStatesToList = function(states, dataset, targetQuality, targetPolutant){
      //appends state names to dropdown list
      var i;
      for(i=0;i<states.length;i++){
        d3.select("#stateDrop")
        .append("a")
        .attr("href", "#")
        .html(states[i])
        .datum(states[i])
        .on("click", function (d) {
          currentStateSelection = d;
          d3.select("#annontationTitle_id")
          .html(currentStateSelection);

          for(i=0; i<states.length;i++){
            if(currentStateSelection==stateAnnotations[i][0]){
              d3.select("#annontationText_id")
              .html(stateAnnotations[i][1]);
              break;
            }
          }

          if(currentSlide<13) {
            currentSlide = currentSlideMax;
            targetQuality.selectAll("path")
                         .remove();

            d3.select("#qualityDaysLegendHolder_id")
              .selectAll("p")
              .remove();

            d3.select("#polutionDaysLegend_id")
              .selectAll("p")
              .remove();

            var currentSelection;
            var i;
            for(i=1;i<13;i++){
              if(i<4){
                d3.select("#qualityDaysLegendLeft_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              } else if (i<7) {
                d3.select("#qualityDaysLegendRight_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              } else if (i<10) {
                d3.select("#polutionDaysLegendLeft_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              } else {
                d3.select("#polutionDaysLegendRight_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              }
            }

            lineDrawer(targetQuality, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
            lineDrawer(targetQuality, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
            lineDrawer(targetQuality, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
            lineDrawer(targetQuality, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
            lineDrawer(targetQuality, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
            lineDrawer(targetQuality, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

            targetPolutant.selectAll("path")
                          .remove();

            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
            lineDrawer(targetPolutant, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");

          } else {
            lineRedrawer(0, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
            lineRedrawer(0, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
            lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
            lineRedrawer(0, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
            lineRedrawer(0, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
            lineRedrawer(0, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");

            lineRedrawer(0, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
            lineRedrawer(0, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
            lineRedrawer(0, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
            lineRedrawer(0, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
            lineRedrawer(0, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
            lineRedrawer(0, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
          }
        });
      }
    }

    var filterFunction = function(data, stateSelection, filterValue){
      //Takes an array consisting of CSV data and parses it using filterValue a string for use in a d3 line function
      var i;
      var tempArray = []; //first element year, second element desired term , third term available data for that year, Fourth term the calculated data
      var yearCount = 0;

      tempArray[0] = [ data[0]["Year"], 0, 0, 0];

      //Decides whether to choose all state data or just one state.
      if(stateSelection == "All U.S. States") {
        for( i = 0; i<data.length; i++) {
          if(data[i]["Year"].getTime() == tempArray[yearCount][0].getTime()) {
            tempArray[yearCount][1] += data[i][filterValue];
            tempArray[yearCount][2] += data[i]["Days_with_AQI"];
          } else {
            yearCount++;
            tempArray[yearCount] = [ data[i]["Year"], data[i][filterValue], data[i]["Days_with_AQI"], 0];
          }
        }
      } else {
        for( i = 0; i<data.length; i++) {
          if(data[i]["State"] == stateSelection){

            if(data[i]["Year"].getTime() == tempArray[yearCount][0].getTime()) {
              tempArray[yearCount][1] += data[i][filterValue];
              tempArray[yearCount][2] += data[i]["Days_with_AQI"];
            } else {
              yearCount++;
              tempArray[yearCount] = [ data[i]["Year"], data[i][filterValue], data[i]["Days_with_AQI"], 0];
            }

          }
        }
      }


      //convert to average values
      for( i = 0; i < tempArray.length; i++) {
        if(tempArray[i][2] !=0){
          tempArray[i][3] = tempArray[i][1]/tempArray[i][2];
        } else {
          tempArray[i][3] = -1;
        }
      }

      return tempArray;
    }

    var axisScaleFunction = function (data, lineClass){
      var filteredData = filterFunction(data, "All U.S. States", lineClass);
      //console.log(filterValue);
      //console.table(filteredData);

      xScale = d3.scaleTime()
      .domain([
        filteredData[0][0],
        filteredData[filteredData.length-1][0]
      ])
      .range([padding, w-padding]);

      yScale = d3.scaleLinear()
      .domain([0, 1])
      .range([h-padding, padding]);

      return [xScale, yScale];

    }

    var lineDrawer = function(target, data, stateSelection, filterValue, lineClass){
      //arguments:
      //target the d3 selection to draw the lineClass
      //data the data to display
      //filterValue the string matching the CSV header to display
      //lineClass the css class to draw the line

      var filteredData = filterFunction(data, stateSelection, filterValue);
      //console.log(filterValue);
      //console.table(filteredData);

      xScale = d3.scaleTime()
      .domain([
        filteredData[0][0],
        filteredData[filteredData.length-1][0]
      ])
      .range([padding, w-padding]);

      yScale = d3.scaleLinear()
      .domain([0, 1])
      .range([h-padding, padding]);

      //Define line generator
      var tempLine =  d3.line()
      .defined(function(d) { return d[3] >= 0;})
      .x(function(d) { return xScale(d[0]); })
      .y(function(d) { return yScale(d[3]); });

      target.append("path")
      .datum(filteredData)
      .attr("class", lineClass)
      .attr("id", lineClass + "_id")
      .attr("d", tempLine)
      .attr("opacity", 0)
      .transition()
      .duration(1000)
      .attr("opacity", 1);



    }

    var lineRedrawer = function(target, data, stateSelection, filterValue, lineClass){
      //arguments:
      //target the d3 selection to draw the lineClass
      //data the data to display
      //filterValue the string matching the CSV header to display
      //lineClass the css class to draw the line

      var filteredData = filterFunction(data, stateSelection, filterValue);
      //console.log(filterValue);
      //console.table(filteredData);

      xScale = d3.scaleTime()
      .domain([
        filteredData[0][0],
        filteredData[filteredData.length-1][0]
      ])
      .range([padding, w-padding]);

      yScale = d3.scaleLinear()
      .domain([0, 1])
      .range([h-padding, padding]);

      //Define line generator
      var tempLine =  d3.line()
      .defined(function(d) { return d[3] >= 0;})
      .x(function(d) { return xScale(d[0]); })
      .y(function(d) { return yScale(d[3]); });

      d3.select("#" + lineClass + "_id")
      .datum(filteredData)
      .transition()
      .duration(1000)
      .attr("d", tempLine);


      return [xScale, yScale];


    }

    var drawAxes = function(target, xAxis_scale, yAxis_scale) {
      var xAxis = d3.axisBottom()
      .scale(xAxis_scale);

      var yAxis = d3.axisLeft()
      .scale(yAxis_scale);

      target.append("g")
      .attr("class", "axis")
      .attr("transform", "translate(0,"+(h-padding) + ")")
      .call(xAxis);

      target.append("g")
      .attr("class", "axis")
      .attr("transform", "translate("+padding + ", 0)")
      .call(yAxis);
    }

    d3.csv("/data/annual_aqi_by_county_merged.csv", rowConverter, function(data) {
      //console.table(data);
      dataset = data;
      currentSlideMax = annotationText.length;
      statesArray = statesGenerator(dataset);
      //console.log(statesArray);


      d3.select("#annontationTitle")
        .html(currentStateSelection);



      var qualityDaysGraph = d3.selectAll("#qualityDaysGraphDIV_id")
      .append("svg")
      .attr("width", w)
      .attr("height", h);

      var scalesQualityDays = axisScaleFunction(dataset, "Good_Days");

      drawAxes(qualityDaysGraph, scalesQualityDays[0], scalesQualityDays[1]);

      var polutionDaysGraph = d3.selectAll("#polutionDaysGraphDIV_id")
      .append("svg")
      .attr("width", w)
      .attr("height", h);

      var scalesPolutionDays = axisScaleFunction(dataset, "Days_SO2");

      drawAxes(polutionDaysGraph, scalesPolutionDays[0], scalesPolutionDays[1]);

      nextButtonFunctionInitialize(qualityDaysGraph, polutionDaysGraph, dataset);
      backButtonFunctionInitialize(qualityDaysGraph, polutionDaysGraph, dataset);
      addStatesToList(statesArray, dataset, qualityDaysGraph, polutionDaysGraph);

      d3.select("#annontationTitle_id")
      .html(annotationText[currentSlide][0]);

      d3.select("#annontationText_id")
      .html(annotationText[currentSlide][1]);

      lineDrawer(qualityDaysGraph, dataset, currentStateSelection, "Good_Days", "Good_Days_Line");
      lineDrawer(qualityDaysGraph, dataset, currentStateSelection, "Moderate_Days", "Moderate_Days_Line");
      lineDrawer(qualityDaysGraph, dataset, currentStateSelection, "Unhealthy_for_Sensitive_Groups_Days", "Unhealthy_for_Sensitive_Groups_Days_Line");
      lineDrawer(qualityDaysGraph, dataset, currentStateSelection, "Unhealthy_Days", "Unhealthy_Days_Line");
      lineDrawer(qualityDaysGraph, dataset, currentStateSelection, "Very_Unhealthy_Days", "Very_Unhealthy_Days_Line");
      lineDrawer(qualityDaysGraph, dataset, currentStateSelection, "Hazardous_Days", "Hazardous_Days_Line");


      lineDrawer(polutionDaysGraph, dataset, currentStateSelection, "Days_SO2", "Days_SO2_Line");
      lineDrawer(polutionDaysGraph, dataset, currentStateSelection, "Days_CO", "Days_CO_Line");
      lineDrawer(polutionDaysGraph, dataset, currentStateSelection, "Days_NO2", "Days_NO2_Line");
      lineDrawer(polutionDaysGraph, dataset, currentStateSelection, "Days_PM10", "Days_PM10_Line");
      lineDrawer(polutionDaysGraph, dataset, currentStateSelection, "Days_PM25", "Days_PM25_Line");
      lineDrawer(polutionDaysGraph, dataset, currentStateSelection, "Days_Ozone", "Days_Ozone_Line");
      
      for(i=1;i<13;i++){
              if(i<4){
                d3.select("#qualityDaysLegendLeft_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              } else if (i<7) {
                d3.select("#qualityDaysLegendRight_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              } else if (i<10) {
                d3.select("#polutionDaysLegendLeft_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              } else {
                d3.select("#polutionDaysLegendRight_id")
                .append("p")
                .attr("class",legendText[i][1]+"_Legend")
                .html(legendText[i][0]);
              }
            }



    });
    </script>
  </div>
</body>
</html>
